<!DOCTYPE html>

<html>
<head>
  <title>WebVR.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="OSG.html">
                OSG.js
              </a>
            
              
              <a class="source" href="BlendColor.html">
                BlendColor.js
              </a>
            
              
              <a class="source" href="BlendFunc.html">
                BlendFunc.js
              </a>
            
              
              <a class="source" href="BoundingBox.html">
                BoundingBox.js
              </a>
            
              
              <a class="source" href="BoundingSphere.html">
                BoundingSphere.js
              </a>
            
              
              <a class="source" href="BufferArray.html">
                BufferArray.js
              </a>
            
              
              <a class="source" href="Camera.html">
                Camera.js
              </a>
            
              
              <a class="source" href="ComputeMatrixFromNodePath.html">
                ComputeMatrixFromNodePath.js
              </a>
            
              
              <a class="source" href="CullFace.html">
                CullFace.js
              </a>
            
              
              <a class="source" href="CullSettings.html">
                CullSettings.js
              </a>
            
              
              <a class="source" href="CullStack.html">
                CullStack.js
              </a>
            
              
              <a class="source" href="CullVisitor.html">
                CullVisitor.js
              </a>
            
              
              <a class="source" href="Depth.html">
                Depth.js
              </a>
            
              
              <a class="source" href="DrawArrayLengths.html">
                DrawArrayLengths.js
              </a>
            
              
              <a class="source" href="DrawArrays.html">
                DrawArrays.js
              </a>
            
              
              <a class="source" href="DrawElements.html">
                DrawElements.js
              </a>
            
              
              <a class="source" href="EllipsoidModel.html">
                EllipsoidModel.js
              </a>
            
              
              <a class="source" href="FrameBufferObject.html">
                FrameBufferObject.js
              </a>
            
              
              <a class="source" href="FrameStamp.html">
                FrameStamp.js
              </a>
            
              
              <a class="source" href="Geometry.html">
                Geometry.js
              </a>
            
              
              <a class="source" href="Image.html">
                Image.js
              </a>
            
              
              <a class="source" href="KdTree.html">
                KdTree.js
              </a>
            
              
              <a class="source" href="KdTreeBuilder.html">
                KdTreeBuilder.js
              </a>
            
              
              <a class="source" href="Light.html">
                Light.js
              </a>
            
              
              <a class="source" href="LightSource.html">
                LightSource.js
              </a>
            
              
              <a class="source" href="LineWidth.html">
                LineWidth.js
              </a>
            
              
              <a class="source" href="Lod.html">
                Lod.js
              </a>
            
              
              <a class="source" href="Map.html">
                Map.js
              </a>
            
              
              <a class="source" href="Material.html">
                Material.js
              </a>
            
              
              <a class="source" href="Math.html">
                Math.js
              </a>
            
              
              <a class="source" href="Matrix.html">
                Matrix.js
              </a>
            
              
              <a class="source" href="MatrixTransform.html">
                MatrixTransform.js
              </a>
            
              
              <a class="source" href="Node.html">
                Node.js
              </a>
            
              
              <a class="source" href="NodeVisitor.html">
                NodeVisitor.js
              </a>
            
              
              <a class="source" href="Notify.html">
                Notify.js
              </a>
            
              
              <a class="source" href="Object.html">
                Object.js
              </a>
            
              
              <a class="source" href="PagedLOD.html">
                PagedLOD.js
              </a>
            
              
              <a class="source" href="PrimitiveSet.html">
                PrimitiveSet.js
              </a>
            
              
              <a class="source" href="Program.html">
                Program.js
              </a>
            
              
              <a class="source" href="Projection.html">
                Projection.js
              </a>
            
              
              <a class="source" href="Quat.html">
                Quat.js
              </a>
            
              
              <a class="source" href="RenderBin.html">
                RenderBin.js
              </a>
            
              
              <a class="source" href="RenderStage.html">
                RenderStage.js
              </a>
            
              
              <a class="source" href="Shader.html">
                Shader.js
              </a>
            
              
              <a class="source" href="ShaderGenerator.html">
                ShaderGenerator.js
              </a>
            
              
              <a class="source" href="Shape.html">
                Shape.js
              </a>
            
              
              <a class="source" href="Stack.html">
                Stack.js
              </a>
            
              
              <a class="source" href="State.html">
                State.js
              </a>
            
              
              <a class="source" href="StateAttribute.html">
                StateAttribute.js
              </a>
            
              
              <a class="source" href="StateGraph.html">
                StateGraph.js
              </a>
            
              
              <a class="source" href="StateSet.html">
                StateSet.js
              </a>
            
              
              <a class="source" href="Texture.html">
                Texture.js
              </a>
            
              
              <a class="source" href="TextureCubeMap.html">
                TextureCubeMap.js
              </a>
            
              
              <a class="source" href="TextureManager.html">
                TextureManager.js
              </a>
            
              
              <a class="source" href="Transform.html">
                Transform.js
              </a>
            
              
              <a class="source" href="TransformEnums.html">
                TransformEnums.js
              </a>
            
              
              <a class="source" href="TriangleIndexFunctor.html">
                TriangleIndexFunctor.js
              </a>
            
              
              <a class="source" href="Uniform.html">
                Uniform.js
              </a>
            
              
              <a class="source" href="UpdateVisitor.html">
                UpdateVisitor.js
              </a>
            
              
              <a class="source" href="Utils.html">
                Utils.js
              </a>
            
              
              <a class="source" href="Vec2.html">
                Vec2.js
              </a>
            
              
              <a class="source" href="Vec3.html">
                Vec3.js
              </a>
            
              
              <a class="source" href="Vec4.html">
                Vec4.js
              </a>
            
              
              <a class="source" href="Viewport.html">
                Viewport.js
              </a>
            
              
              <a class="source" href="WebGLCaps.html">
                WebGLCaps.js
              </a>
            
              
              <a class="source" href="osg.html">
                osg.js
              </a>
            
              
              <a class="source" href="Animation.html">
                Animation.js
              </a>
            
              
              <a class="source" href="AnimationUpdateCallback.html">
                AnimationUpdateCallback.js
              </a>
            
              
              <a class="source" href="BasicAnimationManager.html">
                BasicAnimationManager.js
              </a>
            
              
              <a class="source" href="Channel.html">
                Channel.js
              </a>
            
              
              <a class="source" href="Easing.html">
                Easing.js
              </a>
            
              
              <a class="source" href="FloatLerpChannel.html">
                FloatLerpChannel.js
              </a>
            
              
              <a class="source" href="FloatTarget.html">
                FloatTarget.js
              </a>
            
              
              <a class="source" href="Interpolator.html">
                Interpolator.js
              </a>
            
              
              <a class="source" href="Keyframe.html">
                Keyframe.js
              </a>
            
              
              <a class="source" href="LinkVisitor.html">
                LinkVisitor.js
              </a>
            
              
              <a class="source" href="QuatLerpChannel.html">
                QuatLerpChannel.js
              </a>
            
              
              <a class="source" href="QuatSlerpChannel.html">
                QuatSlerpChannel.js
              </a>
            
              
              <a class="source" href="QuatTarget.html">
                QuatTarget.js
              </a>
            
              
              <a class="source" href="Sampler.html">
                Sampler.js
              </a>
            
              
              <a class="source" href="StackedQuaternion.html">
                StackedQuaternion.js
              </a>
            
              
              <a class="source" href="StackedRotateAxis.html">
                StackedRotateAxis.js
              </a>
            
              
              <a class="source" href="StackedTranslate.html">
                StackedTranslate.js
              </a>
            
              
              <a class="source" href="Target.html">
                Target.js
              </a>
            
              
              <a class="source" href="UpdateMatrixTransform.html">
                UpdateMatrixTransform.js
              </a>
            
              
              <a class="source" href="Vec3LerpChannel.html">
                Vec3LerpChannel.js
              </a>
            
              
              <a class="source" href="Vec3Target.html">
                Vec3Target.js
              </a>
            
              
              <a class="source" href="osgAnimation.html">
                osgAnimation.js
              </a>
            
              
              <a class="source" href="Input.html">
                Input.js
              </a>
            
              
              <a class="source" href="Options.html">
                Options.js
              </a>
            
              
              <a class="source" href="ReaderParser.html">
                ReaderParser.js
              </a>
            
              
              <a class="source" href="osgDB.html">
                osgDB.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulator.html">
                FirstPersonManipulator.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulatorDeviceOrientationController.html">
                FirstPersonManipulatorDeviceOrientationController.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulatorMouseKeyboardController.html">
                FirstPersonManipulatorMouseKeyboardController.js
              </a>
            
              
              <a class="source" href="FirstPersonManipulatorOculusController.html">
                FirstPersonManipulatorOculusController.js
              </a>
            
              
              <a class="source" href="Manipulator.html">
                Manipulator.js
              </a>
            
              
              <a class="source" href="OrbitManipulator.html">
                OrbitManipulator.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorDeviceOrientationController.html">
                OrbitManipulatorDeviceOrientationController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorEnums.html">
                OrbitManipulatorEnums.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorGamePadController.html">
                OrbitManipulatorGamePadController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorHammerController.html">
                OrbitManipulatorHammerController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorLeapMotionController.html">
                OrbitManipulatorLeapMotionController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorMouseKeyboardController.html">
                OrbitManipulatorMouseKeyboardController.js
              </a>
            
              
              <a class="source" href="OrbitManipulatorOculusController.html">
                OrbitManipulatorOculusController.js
              </a>
            
              
              <a class="source" href="SwitchManipulator.html">
                SwitchManipulator.js
              </a>
            
              
              <a class="source" href="osgGA.html">
                osgGA.js
              </a>
            
              
              <a class="source" href="osgNameSpace.html">
                osgNameSpace.js
              </a>
            
              
              <a class="source" href="Composer.html">
                Composer.js
              </a>
            
              
              <a class="source" href="IntersectVisitor.html">
                IntersectVisitor.js
              </a>
            
              
              <a class="source" href="Oculus.html">
                Oculus.js
              </a>
            
              
              <a class="source" href="ParameterVisitor.html">
                ParameterVisitor.js
              </a>
            
              
              <a class="source" href="TriangleIntersect.html">
                TriangleIntersect.js
              </a>
            
              
              <a class="source" href="WebVR.html">
                WebVR.js
              </a>
            
              
              <a class="source" href="osgPool.html">
                osgPool.js
              </a>
            
              
              <a class="source" href="osgUtil.html">
                osgUtil.js
              </a>
            
              
              <a class="source" href="View.html">
                View.js
              </a>
            
              
              <a class="source" href="Viewer.html">
                Viewer.js
              </a>
            
              
              <a class="source" href="DeviceOrientation.html">
                DeviceOrientation.js
              </a>
            
              
              <a class="source" href="EventProxy.html">
                EventProxy.js
              </a>
            
              
              <a class="source" href="GamePad.html">
                GamePad.js
              </a>
            
              
              <a class="source" href="Hammer.html">
                Hammer.js
              </a>
            
              
              <a class="source" href="LeapMotion.html">
                LeapMotion.js
              </a>
            
              
              <a class="source" href="Oculus.html">
                Oculus.js
              </a>
            
              
              <a class="source" href="StandardMouseKeyboard.html">
                StandardMouseKeyboard.js
              </a>
            
              
              <a class="source" href="osgViewer.html">
                osgViewer.js
              </a>
            
              
              <a class="source" href="stats.html">
                stats.js
              </a>
            
              
              <a class="source" href="webgl-debug.html">
                webgl-debug.js
              </a>
            
              
              <a class="source" href="webgl-utils.html">
                webgl-utils.js
              </a>
            
              
              <a class="source" href="osg.html">
                osg.js
              </a>
            
              
              <a class="source" href="osgAnimation.html">
                osgAnimation.js
              </a>
            
              
              <a class="source" href="Hammer.html">
                Hammer.js
              </a>
            
              
              <a class="source" href="Leap.html">
                Leap.js
              </a>
            
              
              <a class="source" href="Q.html">
                Q.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>WebVR.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>define( [
    <span class="hljs-string">'osg/Camera'</span>,
    <span class="hljs-string">'osg/FrameBufferObject'</span>,
    <span class="hljs-string">'osg/Matrix'</span>,
    <span class="hljs-string">'osg/Node'</span>,
    <span class="hljs-string">'osg/Program'</span>,
    <span class="hljs-string">'osg/Projection'</span>,
    <span class="hljs-string">'osg/Shader'</span>,
    <span class="hljs-string">'osg/Shape'</span>,
    <span class="hljs-string">'osg/Texture'</span>,
    <span class="hljs-string">'osg/Transform'</span>,
    <span class="hljs-string">'osg/Uniform'</span>,
    <span class="hljs-string">'osg/Viewport'</span>,
    <span class="hljs-string">'osgUtil/Composer'</span>
], <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( Camera, FrameBufferObject, Matrix, Node, Program, Projection, Shader, Shape, Texture, Transform, Uniform, Viewport, Composer )</span> {</span><span class="hljs-pi">

    'use strict'</span>;

    <span class="hljs-keyword">var</span> UpdateRttCameraCallback = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( rootView, offsetView )</span> {</span>
        <span class="hljs-keyword">this</span>._rootView = rootView;
        <span class="hljs-keyword">this</span>._offsetView = offsetView;
    };

    UpdateRttCameraCallback.prototype = {
        update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( node <span class="hljs-comment">/*, nv */</span> )</span> {</span>
            <span class="hljs-keyword">var</span> nodeView = node.getViewMatrix();
            Matrix.mult( <span class="hljs-keyword">this</span>._offsetView, <span class="hljs-keyword">this</span>._rootView, nodeView );
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    };

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">perspectiveMatrixFromVRFieldOfView</span><span class="hljs-params">( fov, zNear, zFar )</span> {</span>

        <span class="hljs-keyword">var</span> matrix = <span class="hljs-keyword">new</span> Matrix.create();

        <span class="hljs-keyword">var</span> upTan = <span class="hljs-built_in">Math</span>.tan( fov.upDegrees * <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">180.0</span> );
        <span class="hljs-keyword">var</span> downTan = <span class="hljs-built_in">Math</span>.tan( fov.downDegrees * <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">180.0</span> );
        <span class="hljs-keyword">var</span> leftTan = <span class="hljs-built_in">Math</span>.tan( fov.leftDegrees * <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">180.0</span> );
        <span class="hljs-keyword">var</span> rightTan = <span class="hljs-built_in">Math</span>.tan( fov.rightDegrees * <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">180.0</span> );

        <span class="hljs-keyword">var</span> xScale = <span class="hljs-number">2.0</span> / ( leftTan + rightTan );
        <span class="hljs-keyword">var</span> yScale = <span class="hljs-number">2.0</span> / ( upTan + downTan );</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>return Matrix.makeFrustum( xmin, xmax, ymin, ymax, znear, zfar, result );</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        matrix[ <span class="hljs-number">0</span> ] = xScale;
        matrix[ <span class="hljs-number">4</span> ] = <span class="hljs-number">0.0</span>;
        matrix[ <span class="hljs-number">8</span> ] = -( ( leftTan - rightTan ) * xScale * <span class="hljs-number">0.5</span> );
        matrix[ <span class="hljs-number">12</span> ] = <span class="hljs-number">0.0</span>;

        matrix[ <span class="hljs-number">1</span> ] = <span class="hljs-number">0.0</span>;
        matrix[ <span class="hljs-number">5</span> ] = yScale;
        matrix[ <span class="hljs-number">9</span> ] = ( ( upTan - downTan ) * yScale * <span class="hljs-number">0.5</span> );
        matrix[ <span class="hljs-number">13</span> ] = <span class="hljs-number">0.0</span>;

        matrix[ <span class="hljs-number">2</span> ] = <span class="hljs-number">0.0</span>;
        matrix[ <span class="hljs-number">6</span> ] = <span class="hljs-number">0.0</span>;
        matrix[ <span class="hljs-number">10</span> ] = zFar / ( zNear - zFar );
        matrix[ <span class="hljs-number">14</span> ] = ( zFar * zNear ) / ( zNear - zFar );

        matrix[ <span class="hljs-number">3</span> ] = <span class="hljs-number">0.0</span>;
        matrix[ <span class="hljs-number">7</span> ] = <span class="hljs-number">0.0</span>;
        matrix[ <span class="hljs-number">11</span> ] = -<span class="hljs-number">1.0</span>;
        matrix[ <span class="hljs-number">15</span> ] = <span class="hljs-number">0.0</span>;

        <span class="hljs-keyword">return</span> matrix;
    }


    <span class="hljs-keyword">var</span> createTexture = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( size )</span> {</span>
        <span class="hljs-keyword">var</span> texture = <span class="hljs-keyword">new</span> Texture();
        texture.setTextureSize( size.width, size.height );
        texture.setMinFilter( <span class="hljs-string">'LINEAR'</span> );
        texture.setMagFilter( <span class="hljs-string">'LINEAR'</span> );
        <span class="hljs-keyword">return</span> texture;
    };

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAssembleShader</span><span class="hljs-params">()</span> {</span>

        <span class="hljs-keyword">var</span> fragmentShader = [
            <span class="hljs-string">'#ifdef GL_ES'</span>,
            <span class="hljs-string">'   precision highp float;'</span>,
            <span class="hljs-string">'#endif'</span>,
            <span class="hljs-string">'varying vec2 FragTexCoord0;'</span>,
            <span class="hljs-string">'uniform sampler2D leftEyeTexture;'</span>,
            <span class="hljs-string">'uniform sampler2D rightEyeTexture;'</span>,

            <span class="hljs-string">'void main() {'</span>,
            <span class="hljs-string">'   if (FragTexCoord0.x &lt; 0.5)'</span>,
            <span class="hljs-string">'       gl_FragColor = texture2D(leftEyeTexture, vec2(FragTexCoord0.x * 2.0, FragTexCoord0.y));'</span>,
            <span class="hljs-string">'   else'</span>,
            <span class="hljs-string">'       gl_FragColor = texture2D(rightEyeTexture, vec2(FragTexCoord0.x * 2.0 - 1.0, FragTexCoord0.y));'</span>,
            <span class="hljs-string">'}'</span>,
        ].join( <span class="hljs-string">'\n'</span> );

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Program(
            <span class="hljs-keyword">new</span> Shader( Shader.VERTEX_SHADER, Composer.Filter.defaultVertexShader ),
            <span class="hljs-keyword">new</span> Shader( Shader.FRAGMENT_SHADER, fragmentShader )
        );
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>This camera will render both textures on the canvas in a single pass</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> createCameraCanvas = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( leftEyeTexture, rightEyeTexture, viewport )</span> {</span>

        <span class="hljs-keyword">var</span> orthoCamera = <span class="hljs-keyword">new</span> Camera();
        orthoCamera.setViewport( viewport );
        orthoCamera.setRenderOrder( Camera.POST_RENDER, <span class="hljs-number">0</span> );
        orthoCamera.setReferenceFrame( Transform.ABSOLUTE_RF );
        Matrix.makeOrtho( -<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, -<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, -<span class="hljs-number">5.0</span>, <span class="hljs-number">5.0</span>, orthoCamera.getProjectionMatrix() );

        <span class="hljs-keyword">var</span> quad = Shape.createTexturedQuadGeometry( -<span class="hljs-number">0.5</span>, -<span class="hljs-number">0.5</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span> );
        <span class="hljs-keyword">var</span> stateSet = quad.getOrCreateStateSet();
        <span class="hljs-keyword">var</span> samplerLeft = Uniform.createInt1( <span class="hljs-number">0</span>, <span class="hljs-string">'leftEyeTexture'</span> );
        <span class="hljs-keyword">var</span> samplerRight = Uniform.createInt1( <span class="hljs-number">1</span>, <span class="hljs-string">'rightEyeTexture'</span> );

        stateSet.setTextureAttributeAndMode( <span class="hljs-number">0</span>, leftEyeTexture );
        stateSet.setTextureAttributeAndMode( <span class="hljs-number">1</span>, rightEyeTexture );
        stateSet.setAttributeAndMode( getAssembleShader() );
        stateSet.addUniform( samplerLeft );
        stateSet.addUniform( samplerRight );

        orthoCamera.addChild( quad );

        <span class="hljs-keyword">return</span> orthoCamera;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>This camera will render the scene on a texture for an eye </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> createCameraRtt = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( texture, projection )</span> {</span>
        <span class="hljs-keyword">var</span> camera = <span class="hljs-keyword">new</span> Camera();
        camera.setName( <span class="hljs-string">'rtt camera'</span> );
        camera.setViewport( <span class="hljs-keyword">new</span> Viewport( <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, texture.getWidth(), texture.getHeight() ) );
        camera.setProjectionMatrix( projection );
        camera.setClearColor( [ <span class="hljs-number">0.3</span>, <span class="hljs-number">0.3</span>, <span class="hljs-number">0.3</span>, <span class="hljs-number">0.0</span> ] );
        camera.setRenderOrder( Camera.PRE_RENDER, <span class="hljs-number">0</span> );
        camera.attachTexture( FrameBufferObject.COLOR_ATTACHMENT0, texture, <span class="hljs-number">0</span> );
        camera.attachRenderBuffer( FrameBufferObject.DEPTH_ATTACHMENT, FrameBufferObject.DEPTH_COMPONENT16 );
        camera.setReferenceFrame( Transform.ABSOLUTE_RF );
        <span class="hljs-keyword">return</span> camera;
    };

    <span class="hljs-keyword">var</span> WebVR = {};

    WebVR.createScene = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( viewer, rttScene, HMDdevice )</span> {</span>

        <span class="hljs-keyword">var</span> root = <span class="hljs-keyword">new</span> Node();
        <span class="hljs-keyword">var</span> worldFactor = <span class="hljs-number">1.0</span>;

        <span class="hljs-keyword">var</span> hmd = getHMDOptions( HMDdevice );</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Compute projections and view matrices for both eyes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> projectionLeft = perspectiveMatrixFromVRFieldOfView( hmd.fovLeft, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span> );
        <span class="hljs-keyword">var</span> projectionRight = perspectiveMatrixFromVRFieldOfView( hmd.fovRight, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span> );
        <span class="hljs-keyword">var</span> viewLeft = Matrix.makeTranslate( worldFactor * hmd.eyeOffsetLeft.x, hmd.eyeOffsetLeft.y, hmd.eyeOffsetLeft.z, Matrix.create() );
        <span class="hljs-keyword">var</span> viewRight = Matrix.makeTranslate( worldFactor * hmd.eyeOffsetRight.x, hmd.eyeOffsetRight.y, hmd.eyeOffsetRight.z, Matrix.create() );</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Each eye is rendered on a texture whose width is half of the final combined texture</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> eyeTextureSize = {
            width: hmd.rttResolution.width / <span class="hljs-number">2.0</span>,
            height: hmd.rttResolution.height
        };

        <span class="hljs-keyword">var</span> leftEyeTexture = createTexture( eyeTextureSize );
        <span class="hljs-keyword">var</span> rightEyeTexture = createTexture( eyeTextureSize );</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Setup the render cameras for both eyes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> camRttLeft = createCameraRtt( leftEyeTexture, projectionLeft );
        <span class="hljs-keyword">var</span> camRttRight = createCameraRtt( rightEyeTexture, projectionRight );</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>The viewMatrix of each eye is updated with the current viewer’s camera viewMatrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> rootViewMatrix = viewer.getCamera().getViewMatrix();
        camRttLeft.setUpdateCallback( <span class="hljs-keyword">new</span> UpdateRttCameraCallback( rootViewMatrix, viewLeft ) );
        camRttRight.setUpdateCallback( <span class="hljs-keyword">new</span> UpdateRttCameraCallback( rootViewMatrix, viewRight ) );</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Render both textures on the canvas, using the viewer’s camera viewport to render on the fullscreen canvas</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> camCanvas = createCameraCanvas( leftEyeTexture, rightEyeTexture, viewer.getCamera().getViewport() );

        camRttLeft.addChild( rttScene );
        camRttRight.addChild( rttScene );

        root.addChild( camRttLeft );
        root.addChild( camRttRight );
        root.addChild( camCanvas );

        <span class="hljs-keyword">return</span> root;
    };

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getHMDOptions</span><span class="hljs-params">( hmdDevice )</span> {</span>

        <span class="hljs-comment">/* WebVR API state as of 22/07/2014
        Firefox { 
            getCurrentEyeFieldOfView()
            getMaximumEyeFieldOfView()
            getRecommendedEyeFieldOfView()
            getEyeTranslation()
        },
        Chrome {
            getCurrentEyeFieldOfView()
            getMaximumEyeFieldOfView()
            getRecommendedEyeFieldOfView()
            getEyeTranslation()
            getRecommendedRenderTargetSize()
        }*/</span>

        <span class="hljs-keyword">var</span> hmd = {

            fovLeft: hmdDevice.getRecommendedEyeFieldOfView( <span class="hljs-string">'left'</span> ),
            fovRight: hmdDevice.getRecommendedEyeFieldOfView( <span class="hljs-string">'right'</span> ),
            eyeOffsetLeft: hmdDevice.getEyeTranslation( <span class="hljs-string">'left'</span> ),
            eyeOffsetRight: hmdDevice.getEyeTranslation( <span class="hljs-string">'right'</span> ),
            rttResolution: {
                width: <span class="hljs-number">1920</span>,
                height: <span class="hljs-number">1080</span>
            },
        };
        <span class="hljs-keyword">if</span> ( hmdDevice.getRecommendedRenderTargetSize )
            hmd.rttResolution = hmdDevice.getRecommendedRenderTargetSize();</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>On Mac (FF+Chromium), the Left and Right angles of both eyes are inverted
Left Eye must see more to the Left than to the Right (Left angle &gt; Right angle)
Right Eye must see more to the Right than to the Left (Right angle &gt; Left angle)
This is because of the nose blocking the view</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> swapLeftAndRight = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( fov )</span> {</span>
            <span class="hljs-keyword">var</span> temp = fov.leftDegrees;
            fov.leftDegrees = fov.rightDegrees;
            fov.rightDegrees = temp;
        };

        <span class="hljs-keyword">if</span> ( hmd.fovLeft.leftDegrees &lt; hmd.fovLeft.rightDegrees ) {
            swapLeftAndRight( hmd.fovLeft );
        }
        <span class="hljs-keyword">if</span> ( hmd.fovRight.rightDegrees &lt; hmd.fovRight.leftDegrees ) {
            swapLeftAndRight( hmd.fovRight );
        }
        
        <span class="hljs-keyword">return</span> hmd;
    }

    <span class="hljs-keyword">return</span> WebVR;

} );</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
